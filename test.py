import numpy as np
from sklearn import svm
from sklearn import preprocessing
from sklearn.feature_selection import SelectKBest,chi2,SelectPercentile,f_classif
import matplotlib.pyplot as plt
from sklearn.metrics import confusion_matrix
from sklearn.metrics import precision_score
from sklearn.metrics import recall_score
from sklearn.multiclass import OneVsRestClassifier
from sklearn.metrics import precision_recall_curve
from sklearn.metrics import average_precision_score
from sklearn.metrics import roc_curve, auc
from sklearn.metrics import precision_recall_curve
from sklearn.externals import joblib
import time
import methods as m

coarse_rnds = [['rnd', 'fold', 'roc_auc', 'pr_auc'], [1, 1, 0.85185185185185186, 0.95533108866442218], [1, 2, 0.92592592592592604, 0.97515432098765431], [1, 3, 1.0, 1.0], [1, 4, 0.20833333333333337, 0.56249323593073597], [1, 5, 0.5, 0.73754960317460316], [1, 6, 0.625, 0.84379960317460312], [1, 7, 0.79166666666666663, 0.91460813492063486], [1, 8, 0.79166666666666674, 0.93469065656565653], [1, 9, 0.79166666666666674, 0.89811507936507939], [1, 10, 0.83333333333333337, 0.94409722222222225], ['Rnd', '1', 'Sec', '11.38'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [2, 1, 0.94017094017094016, 0.92426046176046195], [2, 2, 0.93162393162393164, 0.89153038319705002], [2, 3, 0.90598290598290598, 0.87153371320037998], [2, 4, 0.75961538461538458, 0.6851307852686529], [2, 5, 0.89423076923076916, 0.81001082251082257], [2, 6, 0.91346153846153844, 0.82311507936507933], [2, 7, 0.875, 0.84360119047619042], [2, 8, 0.96153846153846156, 0.95643939393939392], [2, 9, 0.96153846153846145, 0.94746347402597397], [2, 10, 0.97222222222222232, 0.9656705948372617], ['Rnd', '2', 'Sec', '124.19'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [3, 1, 0.91787439613526567, 0.66226304559637894], [3, 2, 0.71980676328502413, 0.52142026771182781], [3, 3, 0.87439613526570037, 0.78318092937658168], [3, 4, 0.85326086956521752, 0.76203529260594483], [3, 5, 0.82608695652173925, 0.63581791982527269], [3, 6, 0.8787878787878789, 0.69003658378658383], [3, 7, 0.94444444444444431, 0.8521299687966355], [3, 8, 0.91414141414141414, 0.78050128883462233], [3, 9, 0.80808080808080807, 0.59413771950003835], [3, 10, 0.77272727272727271, 0.44397831100729651], ['Rnd', '3', 'Sec', '123.75'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [4, 1, 0.81562500000000004, 0.64841809869193234], [4, 2, 0.84687500000000004, 0.6142828794768449], [4, 3, 0.75937500000000002, 0.37278167566867254], [4, 4, 0.6387096774193548, 0.28126412351838048], [4, 5, 0.8774193548387097, 0.52172868389780147], [4, 6, 0.90322580645161288, 0.59437950937950945], [4, 7, 0.82258064516129026, 0.6416995705906996], [4, 8, 0.85161290322580641, 0.67332390789287333], [4, 9, 0.77419354838709675, 0.5406945915926179], [4, 10, 0.84516129032258069, 0.66090437129810942], ['Rnd', '4', 'Sec', '120.27'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [5, 1, 0.73571428571428577, 0.35283129254646289], [5, 2, 0.88571428571428568, 0.53728176617289514], [5, 3, 0.81190476190476191, 0.47247883936183166], [5, 4, 0.81707317073170738, 0.52262163731035716], [5, 5, 0.80975609756097566, 0.46709719314942433], [5, 6, 0.90487804878048772, 0.63883825679861472], [5, 7, 0.86097560975609755, 0.48243300163888392], [5, 8, 0.79756097560975614, 0.50723062848256339], [5, 9, 0.90243902439024382, 0.54152470078940673], [5, 10, 0.8390243902439023, 0.42527713895562869], ['Rnd', '5', 'Sec', '118.37'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [6, 1, 0.875, 0.64507709960012605], [6, 2, 0.79833333333333334, 0.54206869662759227], [6, 3, 0.89666666666666672, 0.54362111863172979], [6, 4, 0.82181818181818178, 0.37036729532155932], [6, 5, 0.80727272727272736, 0.42109080430208917], [6, 6, 0.91156462585034015, 0.5661221826029128], [6, 7, 0.77891156462585032, 0.36836957602256187], [6, 8, 0.8231292517006803, 0.64916068896418311], [6, 9, 0.81972789115646261, 0.40231769057530808], [6, 10, 0.7482993197278911, 0.30179638742058118], ['Rnd', '6', 'Sec', '114.63'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [7, 1, 0.91786179921773148, 0.6925802761952673], [7, 2, 0.82529335071707954, 0.57922620244007628], [7, 3, 0.75228161668839633, 0.30195312235059996], [7, 4, 0.80225988700564965, 0.38057079353906659], [7, 5, 0.88418079096045199, 0.63055695281558466], [7, 6, 0.8728813559322034, 0.5227981452943421], [7, 7, 0.75141242937853114, 0.36759278849063415], [7, 8, 0.91242937853107342, 0.67552216846334501], [7, 9, 0.82627118644067798, 0.36191325433360405], [7, 10, 0.8884180790960452, 0.71744626847391779], ['Rnd', '7', 'Sec', '121.09'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [8, 1, 0.82274247491638797, 0.54026903812529226], [8, 2, 0.81493868450390194, 0.37524446615175855], [8, 3, 0.86287625418060199, 0.47773007854103644], [8, 4, 0.83710407239819007, 0.59146686760433387], [8, 5, 0.79524886877828049, 0.30153731593505784], [8, 6, 0.82126696832579182, 0.53951991891166462], [8, 7, 0.81334841628959276, 0.33938747445324885], [8, 8, 0.81108597285067874, 0.32108702857843929], [8, 9, 0.78846153846153844, 0.38447869083510933], [8, 10, 0.85294117647058831, 0.44948564292604543], ['Rnd', '8', 'Sec', '113.88'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [9, 1, 0.79670329670329665, 0.34447997559529664], [9, 2, 0.89652014652014644, 0.49154624034092936], [9, 3, 0.85897435897435903, 0.54630310890465772], [9, 4, 0.86785009861932938, 0.48969286019289854], [9, 5, 0.84220907297830372, 0.38446991340174191], [9, 6, 0.86982248520710059, 0.49540880511940705], [9, 7, 0.83333333333333337, 0.58385027101063192], [9, 8, 0.78007889546351084, 0.35403227070769461], [9, 9, 0.75049309664694275, 0.24873125611462149], [9, 10, 0.88033395176252316, 0.46859452503057192], ['Rnd', '9', 'Sec', '115.55'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [10, 1, 0.8007662835249042, 0.46369465500263984], [10, 2, 0.88275862068965516, 0.59877574296687919], [10, 3, 0.83371647509578539, 0.43644667543152005], [10, 4, 0.81362889983579634, 0.29438309034023463], [10, 5, 0.86288998357963875, 0.42715292637833208], [10, 6, 0.88587848932676527, 0.62557033793991679], [10, 7, 0.78653530377668301, 0.34643087302162984], [10, 8, 0.85878489326765184, 0.35616530444533201], [10, 9, 0.79802955665024633, 0.45731397582397038], [10, 10, 0.86821705426356588, 0.4937345971821499], ['Rnd', '10', 'Sec', '114.83'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [11, 1, 0.90885416666666663, 0.58595276668749796], [11, 2, 0.88802083333333337, 0.52663275072732652], [11, 3, 0.73893229166666663, 0.33816917285513787], [11, 4, 0.87083333333333324, 0.44640686633914184], [11, 5, 0.76458333333333339, 0.43387900459404682], [11, 6, 0.87569444444444444, 0.66019199796964467], [11, 7, 0.92083333333333328, 0.61516836955204934], [11, 8, 0.90526315789473688, 0.60501463940681877], [11, 9, 0.80526315789473679, 0.35159118424945773], [11, 10, 0.78815789473684217, 0.28961767053067156], ['Rnd', '11', 'Sec', '110.6'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [12, 1, 0.92334905660377353, 0.69987936018641284], [12, 2, 0.84145658263305323, 0.47147295520637927], [12, 3, 0.81568627450980391, 0.46660777834980299], [12, 4, 0.84821428571428581, 0.3981569720510732], [12, 5, 0.82797619047619053, 0.47027037645530101], [12, 6, 0.85833333333333339, 0.51020897112764851], [12, 7, 0.81726190476190474, 0.33625729409215543], [12, 8, 0.83869047619047621, 0.37808536562590239], [12, 9, 0.84107142857142847, 0.3546601960960522], [12, 10, 0.86071428571428565, 0.58306338773001753], ['Rnd', '12', 'Sec', '109.58'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [13, 1, 0.87621483375959075, 0.38539408544330489], [13, 2, 0.87416879795396418, 0.39212889079709823], [13, 3, 0.86700767263427103, 0.48793806546051838], [13, 4, 0.91358695652173916, 0.50509550323893393], [13, 5, 0.87336956521739129, 0.60653471745509613], [13, 6, 0.85163043478260869, 0.4523536523813359], [13, 7, 0.85552115583075339, 0.48390794940387361], [13, 8, 0.73993808049535603, 0.37844692897310644], [13, 9, 0.78534571723426205, 0.41977508181238699], [13, 10, 0.82765737874097001, 0.33168881125052602], ['Rnd', '13', 'Sec', '109.62'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [14, 1, 0.90776470588235281, 0.48863633478505375], [14, 2, 0.87186379928315405, 0.60177254869995922], [14, 3, 0.84543010752688175, 0.40070734775733408], [14, 4, 0.87144212523719167, 0.54106678431714617], [14, 5, 0.7234345351043644, 0.23232346735990242], [14, 6, 0.91793168880455411, 0.6307444023668094], [14, 7, 0.79174573055028463, 0.44893961039966679], [14, 8, 0.81404174573055021, 0.38113975028451152], [14, 9, 0.82163187855787478, 0.370340560576357], [14, 10, 0.9131878557874763, 0.62124589993673829], ['Rnd', '14', 'Sec', '110.83']]

fine_rnds = [['rnd', 'fold', 'roc_auc', 'pr_auc'], [1, 1, 0.48148148148148151, 0.79134599967933306], [1, 2, 0.85185185185185186, 0.95078964245630915], [1, 3, 0.55555555555555558, 0.78299062049062051], [1, 4, 0.91666666666666663, 0.97361111111111109], [1, 5, 0.75, 0.90520156926406925], [1, 6, 0.58333333333333337, 0.69478490259740255], [1, 7, 0.79166666666666674, 0.89811507936507939], [1, 8, 0.58333333333333326, 0.81370851370851371], [1, 9, 0.70833333333333326, 0.90527597402597404], [1, 10, 0.5, 0.78786525974025978], ['Rnd', '1', 'Sec', '11.38'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [2, 1, 0.72222222222222232, 0.74125486274609087], [2, 2, 0.73333333333333339, 0.7882990222902504], [2, 3, 0.74444444444444435, 0.73559108208231017], [2, 4, 0.71249999999999991, 0.80841503267973858], [2, 5, 0.73749999999999993, 0.78907854808590105], [2, 6, 0.5, 0.57905897207367785], [2, 7, 0.58750000000000002, 0.48266655729891023], [2, 8, 0.83750000000000002, 0.66772741147741144], [2, 9, 0.75, 0.74402984678719974], [2, 10, 0.76543209876543195, 0.80633859604447844], ['Rnd', '2', 'Sec', '124.19'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [3, 1, 0.68627450980392157, 0.59198004562039652], [3, 2, 0.71241830065359468, 0.56511625357213591], [3, 3, 0.66013071895424835, 0.73995451810669199], [3, 4, 0.69117647058823528, 0.63593283146591972], [3, 5, 0.71323529411764708, 0.70178053830227749], [3, 6, 0.73611111111111116, 0.76194219523166895], [3, 7, 0.79861111111111116, 0.74591991341991348], [3, 8, 0.74305555555555547, 0.66735449735449737], [3, 9, 0.72916666666666674, 0.62392616642616638], [3, 10, 0.65972222222222221, 0.51971074952959007], ['Rnd', '3', 'Sec', '123.75'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [4, 1, 0.69565217391304346, 0.61372234133144943], [4, 2, 0.73478260869565215, 0.45144400738150736], [4, 3, 0.55652173913043479, 0.47383627100042636], [4, 4, 0.80909090909090919, 0.81482763696876603], [4, 5, 0.59545454545454546, 0.51955359538732404], [4, 6, 0.73636363636363633, 0.61581839990795839], [4, 7, 0.69999999999999984, 0.56582305821418721], [4, 8, 0.69090909090909092, 0.57412375872140942], [4, 9, 0.72727272727272729, 0.6194282116814096], [4, 10, 0.65000000000000002, 0.43418902923147401], ['Rnd', '4', 'Sec', '120.27'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [5, 1, 0.81000000000000005, 0.71389178073388604], [5, 2, 0.70666666666666678, 0.37125535575535573], [5, 3, 0.74666666666666659, 0.43555483237952275], [5, 4, 0.7068965517241379, 0.50564104851862279], [5, 5, 0.64137931034482754, 0.39152660535088385], [5, 6, 0.73448275862068968, 0.71745984572162413], [5, 7, 0.75172413793103454, 0.73452969385591882], [5, 8, 0.73103448275862071, 0.5292968861389914], [5, 9, 0.65172413793103445, 0.53484433918930485], [5, 10, 0.7551724137931034, 0.6956962871436555], ['Rnd', '5', 'Sec', '118.37'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [6, 1, 0.67142857142857149, 0.53541980791481947], [6, 2, 0.71904761904761905, 0.50226134886254836], [6, 3, 0.68095238095238098, 0.48068435283185523], [6, 4, 0.59480519480519478, 0.3909398447741641], [6, 5, 0.65454545454545454, 0.58692906096208275], [6, 6, 0.68051948051948052, 0.67315448613700679], [6, 7, 0.75245098039215685, 0.569829468346437], [6, 8, 0.58823529411764697, 0.39048740738865584], [6, 9, 0.80147058823529405, 0.76272265622594582], [6, 10, 0.65931372549019596, 0.4833225071556273], ['Rnd', '6', 'Sec', '114.63'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [7, 1, 0.65674603174603174, 0.45737297265113575], [7, 2, 0.72232645403377116, 0.55622310913136974], [7, 3, 0.61538461538461531, 0.32722428112984103], [7, 4, 0.56300813008130079, 0.3894741529565155], [7, 5, 0.7357723577235773, 0.59857020505743908], [7, 6, 0.61788617886178865, 0.45570272312100035], [7, 7, 0.66056910569105687, 0.62373042858458938], [7, 8, 0.7032520325203252, 0.44784549650238092], [7, 9, 0.68495934959349603, 0.59190959509692675], [7, 10, 0.81910569105691056, 0.65419066238769896], ['Rnd', '7', 'Sec', '121.09'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [8, 1, 0.69711538461538469, 0.54501102624084852], [8, 2, 0.69871794871794868, 0.65749699061828282], [8, 3, 0.76282051282051277, 0.52776623512076348], [8, 4, 0.73784722222222232, 0.63672925280027615], [8, 5, 0.72504091653027825, 0.49988979895438912], [8, 6, 0.71849427168576108, 0.55143497688738485], [8, 7, 0.56464811783960722, 0.38820898133479287], [8, 8, 0.54991816693944351, 0.32719861728412192], [8, 9, 0.68576104746317512, 0.32815495484221224], [8, 10, 0.6726677577741409, 0.46979972554956817], ['Rnd', '8', 'Sec', '113.88'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [9, 1, 0.7222222222222221, 0.36590041477991775], [9, 2, 0.73809523809523814, 0.64666480343154542], [9, 3, 0.5264550264550264, 0.27892569769813819], [9, 4, 0.81766381766381768, 0.58631187621080838], [9, 5, 0.72222222222222232, 0.55940445933777505], [9, 6, 0.62250712250712248, 0.35576972891005382], [9, 7, 0.63390313390313391, 0.46693337960824771], [9, 8, 0.72934472934472938, 0.58558399835180275], [9, 9, 0.65669515669515677, 0.3667794255304932], [9, 10, 0.70512820512820518, 0.38438171838695334], ['Rnd', '9', 'Sec', '115.55'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [10, 1, 0.66333333333333333, 0.34055455966337994], [10, 2, 0.74111111111111105, 0.43545386431566374], [10, 3, 0.6644444444444445, 0.34779880977891037], [10, 4, 0.64166666666666661, 0.44725794766146698], [10, 5, 0.71190476190476182, 0.47522419420935169], [10, 6, 0.78571428571428581, 0.71357832933304355], [10, 7, 0.48928571428571427, 0.22017503969965022], [10, 8, 0.64523809523809528, 0.39183004963525947], [10, 9, 0.75119047619047619, 0.61613798499455186], [10, 10, 0.70357142857142863, 0.37485998181393382], ['Rnd', '10', 'Sec', '114.83'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [11, 1, 0.66761363636363624, 0.33858616397999586], [11, 2, 0.70738636363636365, 0.37191163314627118], [11, 3, 0.61458333333333326, 0.3126028911060062], [11, 4, 0.70101010101010108, 0.57430425050747114], [11, 5, 0.7474747474747474, 0.62308691094700608], [11, 6, 0.7020202020202021, 0.36348839071757144], [11, 7, 0.59090909090909083, 0.50555127919411302], [11, 8, 0.53333333333333333, 0.23302246622959105], [11, 9, 0.66161616161616166, 0.36747911128412053], [11, 10, 0.62403846153846154, 0.47178472875923017], ['Rnd', '11', 'Sec', '110.6'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [12, 1, 0.6601027397260274, 0.49154517247696244], [12, 2, 0.71746575342465757, 0.48508654640013149], [12, 3, 0.69777397260273988, 0.34518228984127625], [12, 4, 0.66301369863013693, 0.2452316164035041], [12, 5, 0.67274305555555558, 0.3201186237923917], [12, 6, 0.62326388888888884, 0.33620130304449958], [12, 7, 0.63802083333333326, 0.40778044380808937], [12, 8, 0.74479166666666674, 0.50407839055792958], [12, 9, 0.64236111111111116, 0.45400641960321214], [12, 10, 0.64583333333333337, 0.3783594914799554], ['Rnd', '12', 'Sec', '109.58'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [13, 1, 0.53090096798212949, 0.18329755369109735], [13, 2, 0.76098287416232302, 0.49219960333967516], [13, 3, 0.72896500372300821, 0.42815399933869097], [13, 4, 0.615506329113924, 0.35390602102412477], [13, 5, 0.67246835443037978, 0.35973260265441903], [13, 6, 0.66218354430379744, 0.38413506300298561], [13, 7, 0.66376582278481022, 0.41135523756784631], [13, 8, 0.72151898734177211, 0.53281570266870215], [13, 9, 0.65189873417721522, 0.47248780416290986], [13, 10, 0.66440422322775261, 0.4903363478184028], ['Rnd', '13', 'Sec', '109.62'], ['rnd', 'fold', 'roc_auc', 'pr_auc'], [14, 1, 0.67715458276333784, 0.49436229237321327], [14, 2, 0.55403556771545825, 0.25497482506479319], [14, 3, 0.6333789329685362, 0.43151382816986233], [14, 4, 0.6344476744186045, 0.28781088687784323], [14, 5, 0.79578488372093015, 0.51857675532569281], [14, 6, 0.61245674740484435, 0.27991960491648127], [14, 7, 0.63737024221453287, 0.25736622166043843], [14, 8, 0.7314878892733564, 0.46703939282310752], [14, 9, 0.66089965397923867, 0.43962523889580174], [14, 10, 0.74463667820069213, 0.44357932486015078], ['Rnd', '14', 'Sec', '110.83']]


f = open('test.txt', 'w')
results = []
f.write('coarse \n')
for i in range(1,21):
    roc_Sum = 0.0
    pr_Sum = 0.0
    for row in coarse_rnds:
        if(row[0] == i):
            roc_Sum += row[2]
            pr_Sum += row[3]
    f.write('{0},{1:.3f},{2:.3f} \n'.format(i,(roc_Sum/10.0),(pr_Sum/10.0)))

f.write('fine \n')
for i in range(1,21):
    roc_Sum = 0.0
    pr_Sum = 0.0
    for row in fine_rnds:
        if(row[0] == i):
            roc_Sum += row[2]
            pr_Sum += row[3]
    f.write('{0},{1:.3f},{2:.3f} \n'.format(i,(roc_Sum/10.0),(pr_Sum/10.0)))

f.close()
#
#
# f.write('fine \n')
# for i in range(1,21):
#     roc_Sum = 0.0
#     pr_Sum = 0.0
#     for row in fine_rnds:
#         # if (row[2] == 'Sec'):
#         #     results.append(row)
#         #     f.write('{1},{3} \n'.format(*row))
#
#         if(row[0] == i):
#             roc_Sum += row[2]
#             pr_Sum += row[3]
#     f.write('{0},{1},{2} \n'.format(i,(roc_Sum/10.0),(pr_Sum/10.0)))
#
#
# f.close()
